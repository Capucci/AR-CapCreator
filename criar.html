<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Criar Projeto AR - CapCreator</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
    }
    .upload-area {
      border: 2px dashed #ddd;
      border-radius: 10px;
      padding: 30px 20px;
      margin-bottom: 20px;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
    }
    .upload-area:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }
    .upload-area.has-file {
      border-color: #28a745;
      background: #f0fff0;
    }
    .upload-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    .upload-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .upload-subtitle {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .file-info {
      margin-top: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      font-size: 14px;
    }
    input[type="file"] {
      display: none;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: bold;
    }
    .form-group input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      transition: transform 0.3s;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-secondary {
      background: #6c757d;
      margin-top: 10px;
    }
    .btn-success {
      background: #28a745;
    }
    .preview {
      margin-top: 30px;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 10px;
      display: none;
      border: 2px solid #28a745;
    }
    .preview.show {
      display: block;
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .progress {
      margin-top: 20px;
      height: 4px;
      background: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
      display: none;
    }
    .progress.show {
      display: block;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      transition: width 0.3s;
    }
    .status {
      text-align: center;
      margin-top: 10px;
      color: #666;
    }
    .qr-code {
      text-align: center;
      margin: 20px 0;
    }
    .qr-code img {
      max-width: 200px;
      border: 1px solid #ddd;
      padding: 10px;
      background: white;
    }
    .project-url {
      background: white;
      padding: 15px;
      border-radius: 5px;
      border: 1px solid #ddd;
      word-break: break-all;
      margin: 20px 0;
      font-size: 14px;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .action-buttons .btn {
      flex: 1;
      margin: 0;
    }
    .warning {
      background: #fff3cd;
      color: #856404;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Criar Novo Projeto AR</h1>
    <div class="subtitle">Fa√ßa upload dos arquivos para criar sua experi√™ncia</div>

    <div class="form-group">
      <label for="projectName">üìù Nome do Projeto</label>
      <input type="text" id="projectName" placeholder="Ex: Meu Primeiro AR" value="Meu Projeto AR">
    </div>

    <!-- Upload Target .mind -->
    <div class="upload-area" id="targetArea" onclick="document.getElementById('targetFile').click()">
      <div class="upload-icon">üéØ</div>
      <div class="upload-title">Target (.mind)</div>
      <div class="upload-subtitle">Clique para fazer upload do arquivo .mind</div>
      <input type="file" id="targetFile" accept=".mind" style="display: none;">
      <div class="file-info" id="targetInfo">Nenhum arquivo selecionado</div>
    </div>

    <!-- Upload Modelo 3D -->
    <div class="upload-area" id="modeloArea" onclick="document.getElementById('modeloFile').click()">
      <div class="upload-icon">üì¶</div>
      <div class="upload-title">Modelo 3D (.glb)</div>
      <div class="upload-subtitle">Clique para fazer upload do modelo 3D</div>
      <input type="file" id="modeloFile" accept=".glb,.gltf" style="display: none;">
      <div class="file-info" id="modeloInfo">Nenhum arquivo selecionado</div>
    </div>

    <!-- Upload √Åudio -->
    <div class="upload-area" id="audioArea" onclick="document.getElementById('audioFile').click()">
      <div class="upload-icon">üéµ</div>
      <div class="upload-title">√Åudio (.mp3)</div>
      <div class="upload-subtitle">Clique para fazer upload do √°udio</div>
      <input type="file" id="audioFile" accept=".mp3,.wav,.ogg" style="display: none;">
      <div class="file-info" id="audioInfo">Nenhum arquivo selecionado</div>
    </div>

    <!-- Bot√µes -->
    <button class="btn" id="createBtn" onclick="criarProjeto()">üöÄ Criar Projeto AR</button>
    <button class="btn btn-secondary" onclick="window.location.href='index.html'">‚Üê Voltar</button>

    <!-- Progresso -->
    <div class="progress" id="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="status" id="status"></div>

    <!-- Preview do Projeto Criado -->
    <div class="preview" id="preview">
      <h2 style="color: #28a745; text-align: center; margin-bottom: 20px;">‚úÖ Projeto Criado com Sucesso!</h2>
      
      <div class="qr-code" id="qrPreview"></div>
      
      <div class="project-url" id="projectUrl"></div>
      
      <div class="warning">
        ‚ö†Ô∏è Guarde este link! Ele √© √∫nico para seu projeto e voc√™ pode compartilhar com seus clientes.
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-secondary" onclick="copiarLink()">üìã Copiar Link</button>
        <button class="btn btn-success" onclick="window.open(document.getElementById('projectUrl').textContent, '_blank')">üëÅÔ∏è Abrir AR</button>
      </div>
      
      <button class="btn btn-secondary" style="margin-top: 10px;" onclick="window.location.href='index.html'">üè† Ir para P√°gina Inicial</button>
    </div>
  </div>

  <script>
    let projectData = {
      target: null,
      modelo: null,
      audio: null
    };

    // Preview dos arquivos
    document.getElementById('targetFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        projectData.target = file;
        document.getElementById('targetInfo').innerHTML = `‚úÖ ${file.name} (${(file.size/1024).toFixed(2)} KB)`;
        document.getElementById('targetArea').classList.add('has-file');
      }
    });

    document.getElementById('modeloFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        projectData.modelo = file;
        document.getElementById('modeloInfo').innerHTML = `‚úÖ ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
        document.getElementById('modeloArea').classList.add('has-file');
      }
    });

    document.getElementById('audioFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        projectData.audio = file;
        document.getElementById('audioInfo').innerHTML = `‚úÖ ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
        document.getElementById('audioArea').classList.add('has-file');
      }
    });

    // Fun√ß√£o para criar projeto
    function criarProjeto() {
      // Verificar se todos os arquivos foram selecionados
      if (!projectData.target || !projectData.modelo || !projectData.audio) {
        alert('‚ùå Por favor, selecione todos os arquivos necess√°rios!');
        return;
      }

      const projectName = document.getElementById('projectName').value || 'Projeto AR';
      
      // Mostrar progresso
      document.getElementById('progress').classList.add('show');
      document.getElementById('status').innerHTML = '‚è≥ Processando arquivos...';
      document.getElementById('createBtn').disabled = true;

      // Simular progresso
      let progress = 0;
      const interval = setInterval(() => {
        progress += 10;
        document.getElementById('progressBar').style.width = progress + '%';
        
        if (progress >= 100) {
          clearInterval(interval);
          document.getElementById('status').innerHTML = '‚úÖ Salvando projeto...';
          setTimeout(() => {
            finalizarCriacao(projectName);
          }, 500);
        }
      }, 200);
    }

    // Finalizar cria√ß√£o do projeto
    function finalizarCriacao(projectName) {
      // Gerar ID √∫nico para o projeto
      const projectId = Date.now().toString(36) + Math.random().toString(36).substr(2);
      
      // Criar objeto do projeto
      const projeto = {
        id: projectId,
        nome: projectName,
        data: new Date().toISOString(),
        target: {
          nome: projectData.target.name,
          tamanho: projectData.target.size
        },
        modelo: {
          nome: projectData.modelo.name,
          tamanho: projectData.modelo.size
        },
        audio: {
          nome: projectData.audio.name,
          tamanho: projectData.audio.size
        }
      };

      // Salvar no localStorage
      const projetos = JSON.parse(localStorage.getItem('ar_projetos') || '[]');
      projetos.push(projeto);
      localStorage.setItem('ar_projetos', JSON.stringify(projetos));

      // Salvar arquivos (simulado - em produ√ß√£o seria num servidor)
      salvarArquivosSimulados(projectId);

      // Gerar URL do projeto
      const baseUrl = window.location.origin + window.location.pathname.replace('criar.html', '');
      const projectUrl = `${baseUrl}ver.html?id=${projectId}`;
      
      // Mostrar preview
      document.getElementById('status').innerHTML = '‚úÖ Projeto criado com sucesso!';
      document.getElementById('progress').classList.remove('show');
      
      // Gerar QR Code
      const qrUrl = `https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=${encodeURIComponent(projectUrl)}&choe=UTF-8`;
      document.getElementById('qrPreview').innerHTML = `<img src="${qrUrl}" style="max-width: 200px; border: 1px solid #ddd; padding: 10px; background: white;">`;
      
      document.getElementById('projectUrl').innerHTML = projectUrl;
      document.getElementById('preview').classList.add('show');
      
      // Reset form
      document.getElementById('createBtn').disabled = false;
      
      // Limpar sele√ß√µes
      limparSelecoes();

      // Rolagem suave at√© o preview
      document.getElementById('preview').scrollIntoView({ behavior: 'smooth' });
    }

    // Salvar arquivos simulados (armazenar nomes)
    function salvarArquivosSimulados(projectId) {
      const filesRef = {
        target: {
          nome: projectData.target.name,
          tipo: 'mind'
        },
        modelo: {
          nome: projectData.modelo.name,
          tipo: 'glb'
        },
        audio: {
          nome: projectData.audio.name,
          tipo: 'mp3'
        }
      };
      
      localStorage.setItem(`projeto_${projectId}_files`, JSON.stringify(filesRef));
    }

    // Limpar sele√ß√µes
    function limparSelecoes() {
      projectData = { target: null, modelo: null, audio: null };
      
      document.getElementById('targetFile').value = '';
      document.getElementById('modeloFile').value = '';
      document.getElementById('audioFile').value = '';
      
      document.getElementById('targetInfo').innerHTML = 'Nenhum arquivo selecionado';
      document.getElementById('modeloInfo').innerHTML = 'Nenhum arquivo selecionado';
      document.getElementById('audioInfo').innerHTML = 'Nenhum arquivo selecionado';
      
      document.getElementById('targetArea').classList.remove('has-file');
      document.getElementById('modeloArea').classList.remove('has-file');
      document.getElementById('audioArea').classList.remove('has-file');
    }

    // Copiar link
    function copiarLink() {
      const url = document.getElementById('projectUrl').textContent;
      navigator.clipboard.writeText(url).then(() => {
        alert('‚úÖ Link copiado para a √°rea de transfer√™ncia!');
      }).catch(() => {
        alert('‚ùå Erro ao copiar. Selecione o link manualmente.');
      });
    }

    // Drag and drop
    ['targetArea', 'modeloArea', 'audioArea'].forEach(areaId => {
      const area = document.getElementById(areaId);
      
      area.addEventListener('dragover', (e) => {
        e.preventDefault();
        area.style.borderColor = '#667eea';
        area.style.background = '#f8f9ff';
      });

      area.addEventListener('dragleave', (e) => {
        e.preventDefault();
        area.style.borderColor = '#ddd';
        area.style.background = 'white';
      });

      area.addEventListener('drop', (e) => {
        e.preventDefault();
        area.style.borderColor = '#ddd';
        area.style.background = 'white';
        
        const file = e.dataTransfer.files[0];
        if (file) {
          const input = document.getElementById(areaId === 'targetArea' ? 'targetFile' : 
                                               areaId === 'modeloArea' ? 'modeloFile' : 'audioFile');
          
          const dataTransfer = new DataTransfer();
          dataTransfer.items.add(file);
          input.files = dataTransfer.files;
          
          const event = new Event('change', { bubbles: true });
          input.dispatchEvent(event);
        }
      });
    });

    // Prevenir envio do formul√°rio ao pressionar Enter
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>